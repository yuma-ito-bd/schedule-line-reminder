# 複数カレンダー管理機能開発タスク

## 概要
1ユーザーにつき複数のGoogleカレンダーの予定を通知できるようにするため、複数カレンダーを管理できる機能を追加する。
ユーザーとのコミュニケーションはすべてLINE Messaging APIを通じて行う。

## 対象機能
- 購読しているカレンダーの一覧表示
- カレンダーの追加
- カレンダーの削除

## 現在のシステム構成
- **アーキテクチャ**: AWS Lambda + DynamoDB + API Gateway
- **Google Calendar API**: OAuth2認証、現在は`primary`カレンダーのみ対応
- **LINE Messaging API**: Webhookによるメッセージ受信、Push/Reply API
- **データベース**: DynamoDB（現在は`OAuthTokensTable`のみ）

## タスク分類

複数カレンダー管理機能の開発タスクは以下の6つの大項目に分類されています。
各項目の詳細は、対応するファイルを参照してください。

### 📊 [1. データベース設計・実装](./tasks_01_database_design_implementation.md)
- **工数**: 5-7時間
- **優先度**: High
- **内容**: ユーザーカレンダー管理テーブルの設計・実装、リポジトリクラス作成

### 🔌 [2. Google Calendar API拡張](./tasks_02_google_calendar_api_extension.md)
- **工数**: 5-6時間
- **優先度**: High
- **内容**: カレンダーリスト取得機能、複数カレンダーからのイベント取得

### 🤖 [3. LINE Bot機能拡張](./tasks_03_line_bot_functionality_extension.md)
- **工数**: 9-11時間
- **優先度**: High-Medium
- **内容**: カレンダー管理コマンド、対話式フロー、エラーハンドリング

### 🔄 [4. 既存機能のリファクタリング](./tasks_04_existing_functionality_refactoring.md)
- **工数**: 3-5時間
- **優先度**: High-Low
- **内容**: イベント通知機能の改修、認証フローの拡張

### 🧪 [5. テスト実装](./tasks_05_test_implementation.md)
- **工数**: 6-8時間
- **優先度**: Medium-Low
- **内容**: ユニットテスト、結合テスト、CI/CD設定

### 🚀 [6. デプロイメントと運用](./tasks_06_deployment_and_operations.md)
- **工数**: 2.5時間
- **優先度**: High-Low
- **内容**: Lambda権限更新、データ移行、ドキュメント更新

## 開発優先順位

### Phase 1: Core Infrastructure (High Priority)
- **期間**: 週1-2
- **工数**: 15-20時間
- **タスク**:
  1. データベース設計・実装
  2. Google Calendar API拡張
  3. 既存機能のリファクタリング（イベント通知改修）
  4. Lambda権限更新

### Phase 2: LINE Bot機能 (High Priority)  
- **期間**: 週3
- **工数**: 4-5時間
- **タスク**:
  1. カレンダー管理コマンド実装

### Phase 3: UX改善 (Medium Priority)
- **期間**: 週4-5
- **工数**: 9-12時間
- **タスク**:
  1. 対話式フロー
  2. エラーハンドリング
  3. ユニットテスト実装

### Phase 4: 運用・保守 (Low Priority)
- **期間**: 週6以降
- **工数**: 4-6時間
- **タスク**:
  1. 結合テスト
  2. データ移行
  3. ドキュメント更新
  4. 認証フロー拡張

## 技術的考慮事項

### セキュリティ
- カレンダーアクセス権限の適切な管理
- ユーザーデータのプライバシー保護
- LINE Webhook署名検証の継続

### パフォーマンス
- 複数カレンダーの並列取得によるレスポンス時間最適化
- DynamoDB読み書きの効率化
- Lambda関数のコールドスタート対策

### スケーラビリティ  
- ユーザー数増加に対するDynamoDB設計の考慮
- Google Calendar API Rate Limit対策
- LINE Messaging API制限への対応

## 見積もり工数

| フェーズ | 工数 | 内容 |
|---------|------|------|
| **Phase 1** | 15-20時間 | コアインフラ（データベース、API拡張、リファクタリング） |
| **Phase 2** | 4-5時間 | LINE Bot基本機能 |
| **Phase 3** | 9-12時間 | UX改善とテスト |
| **Phase 4** | 4-6時間 | 運用・保守 |
| **総計** | **32-43時間** | 完全実装 |

### 最小実装（MVP）
- **工数**: 約20-25時間（Phase 1-2）
- **内容**: 基本的なカレンダー管理機能
- **対象**: データベース設計、API拡張、基本コマンド

### 完全実装
- **工数**: 約32-43時間（Phase 1-4）
- **内容**: 全機能 + テスト + 運用体制
- **対象**: UX改善、包括的テスト、本格運用準備

## リスクと対策

### 技術リスク
- **Google Calendar API制限**: 段階的ロールアウトとキャッシュ戦略
- **DynamoDB設計**: 初期設計段階での十分な検討
- **Lambda関数サイズ**: モジュール化とレイヤー活用

### スケジュールリスク  
- **工数超過**: Phase単位での柔軟な調整
- **優先度変更**: ユーザーフィードバックに基づく適応

### 運用リスク
- **既存ユーザー影響**: 段階的デプロイとロールバック準備
- **データ移行**: 十分なテストと監視体制